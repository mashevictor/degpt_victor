(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0aa1ba"],{1038:function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"wbs-content-inner"},[t("div",{staticClass:"wbs-main"},[e.isLoaded&&"base"==e.editing?t("div",{staticClass:"opt-group"},[t("div",{staticClass:"opt-group-hd"},[e._m(0),t("div",{staticClass:"group-description"},[e._v(" 启用对象存储，可以将指定目录内容同步至对象存储服务器，以减少主服务器的数据访问以提升服务器性能。 ")]),e.$cnf.is_pro?e._e():t("div",{staticClass:"mt"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getPro()}}},[e._v("升级至PRO")])],1)]),t("wbs-opt-box",{attrs:{name:"启用对象存储",desc:"通过对象存储的方式，迁移WP的多媒体资源至第三方云存储服务器，能够减轻本地服务器压力以保持服务器稳定性和提高网站访问性能。","doc-link":"https://www.wbolt.com/aliyun-oss.html"},model:{value:e.opt.switch,callback:function(t){e.$set(e.opt,"switch",t)},expression:"opt.switch"}}),t("wbs-opt-box",{attrs:{name:"配置存储",desc:"对象存储配置文件支持数据库和wp-config两种，默认采用数据库保存，您也可以选择将对象存储的配置保存至wp-config文件。","doc-link":""},scopedSlots:e._u([{key:"ctrlItems",fn:function(){return[t("el-select",{attrs:{size:"mini",placeholder:"请选择"},model:{value:e.opt.conf,callback:function(t){e.$set(e.opt,"conf",t)},expression:"opt.conf"}},[t("el-option",{attrs:{value:"db",label:"数据库（默认）"}}),t("el-option",{attrs:{value:"file",label:"wp-config.php"}})],1)]},proxy:!0}],null,!1,676680151)}),t("wbs-opt-box",{attrs:{name:"服务商",desc:"目前对象存储我们支持阿里云、腾讯云、百度云和华为云主流服务商，未来根据站长需求加入更多的支持。","doc-link":"https://www.wbolt.com/aliyun-oss.html#oss-setting-for-wpturbo"},scopedSlots:e._u([{key:"ctrlItems",fn:function(){return[t("el-select",{attrs:{size:"mini",placeholder:"请选择"},model:{value:e.opt.vendor,callback:function(t){e.$set(e.opt,"vendor",t)},expression:"opt.vendor"}},[t("el-option",{attrs:{value:"aliyun",label:"阿里云"}}),t("el-option",{attrs:{value:"tencent",label:"腾讯云"}}),t("el-option",{attrs:{value:"huawei",label:"华为云"}}),t("el-option",{attrs:{value:"baidu",label:"百度云"}}),e._e()],2),t("div",{staticClass:"mt align-center"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.editing="vendor-api"}}},[e._v("配置API")])],1)]},proxy:!0}],null,!1,1070029262)}),t("wbs-opt-box",{attrs:{name:"服务模式",desc:"支持选择对象存储服务器作为网站文件备份服务器（私有）或者文件访问服务器（公共读）。","doc-link":""},scopedSlots:e._u([{key:"ctrlItems",fn:function(){return[t("el-radio-group",{attrs:{size:"mini"},model:{value:e.oss_mode,callback:function(t){e.oss_mode=t},expression:"oss_mode"}},[t("el-radio",{attrs:{label:"back"}},[e._v("备份服务 "),t("wbs-tooltip",{attrs:{"data-msg":"将媒体文件上传至对象存储服务器作，相当于将对象存储作为文件备份。"}})],1),t("el-radio",{attrs:{label:"server"}},[e._v("访问服务 "),t("wbs-tooltip",{attrs:{"data-msg":"将媒体文件复制到对象存储服务器（可删除或保留本地服务器源文件），使用对象存储服务器提供文件提供服务。"}})],1),e._e()],2),"server"===e.oss_mode?t("div",{staticClass:"mt align-center"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.editing="server-options"}}},[e._v("文件服务配置")])],1):e._e()]},proxy:!0}],null,!1,1826816427)}),t("wbs-opt-box",{attrs:{name:"媒体库迁移",desc:"同步上传旧的媒体库资源到OSS。","doc-link":""},scopedSlots:e._u([{key:"ctrlItems",fn:function(){return[t("div",{staticClass:"group-description"},[e._v("未同步媒体资源数 "+e._s(e.media_num))]),e.media_num>0?t("div",{staticClass:"mt align-center"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.syncData}},[e._v(e._s(e.in_sync?"数据同步中":"执行同步"))])],1):e._e()]},proxy:!0}],null,!1,2141645900)})],1):e._e(),"vendor-api"===e.editing?t("FormVendorApi",{attrs:{opt:e.opt},on:{save:function(t){e.opt=t,e.editing="base"},cancel:function(t){e.editing="base"}}}):e._e(),"server-options"===e.editing?t("FormServerOptions",{attrs:{opt:e.opt},on:{save:function(t){e.changeServer(t),e.editing="base"},cancel:function(t){e.editing="base"}}}):e._e(),t("wb-prompt",{directives:[{name:"show",rawName:"v-show",value:e.isLoaded&&"base"===e.editing,expression:"isLoaded && editing === 'base'"}],staticClass:"mt"})],1),t("wbs-ctrl-bar",{directives:[{name:"show",rawName:"v-show",value:e.isLoaded&&"base"===e.editing,expression:"isLoaded && editing === 'base'"}],on:{submit:e.updateData}})],1)},n=[function(){var e=this,t=e._self._c;return t("h3",{staticClass:"group-name"},[t("strong",[e._v("对象存储")])])}],i=function(){var e=this,t=e._self._c;return t("div",[e._m(0),t("el-form",{ref:"form",attrs:{size:"small",model:e.opt,"label-width":"8em"}},[t("el-form-item",{attrs:{label:"模式"}},[t("el-radio-group",{attrs:{size:"mini"},model:{value:e.opt.oss_mode,callback:function(t){e.$set(e.opt,"oss_mode",t)},expression:"opt.oss_mode"}},[t("el-radio",{attrs:{label:"back"}},[e._v("仅备份 "),t("wbs-tooltip",{attrs:{"data-msg":"将媒体文件上传至对象存储服务器作，相当于将对象存储作为文件备份。"}})],1),t("el-radio",{attrs:{label:"server"}},[e._v("访问服务（保留本地文件） "),t("wbs-tooltip",{attrs:{"data-msg":"将媒体文件复制到对象存储服务器并保留本地服务器源文件，使用对象存储服务器提供文件提供服务。"}})],1),t("el-radio",{attrs:{label:"server_adv"}},[e._v("访问服务（删除本地文件） "),t("wbs-tooltip",{attrs:{"data-msg":"将媒体文件复制到对象存储服务器并删除本地服务器源文件，使用对象存储服务器提供文件提供服务。"}})],1)],1)],1),e._e(),e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("save",e.opt)}}},[e._v("保存")]),t("el-button",{on:{click:function(t){return e.$emit("cancel")}}},[e._v("取消")])],1)],1),t("wb-key-point",{staticClass:"mt",attrs:{content:"删除服务器本地文件，插件会默认使用用一个空图片替换服务器本地文件。"}})],1)},l=[function(){var e=this,t=e._self._c;return t("h3",{staticClass:"sc-header"},[t("strong",[e._v("文件服务配置")])])}],s={name:"FormServerOptions",props:["opt"],provide(){return{needPro:!0}},mounted(){window.scrollTo(0,0)}},r=s,c=o("2877"),p=Object(c["a"])(r,i,l,!1,null,null,null),u=p.exports,d=function(){var e=this,t=e._self._c;return t("div",[e._m(0),t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"阿里云",name:"aliyun"}},[t("el-form",{ref:"form",attrs:{size:"small",model:e.opt,"label-width":"10em"}},[t("el-form-item",{attrs:{label:"ACCESSKey ID"}},[t("el-input",{attrs:{placeholder:"登录阿里云工作台>点击主账号头像>AccessKey管理，创建生成。"},model:{value:e.opt.aliyun.id,callback:function(t){e.$set(e.opt.aliyun,"id",t)},expression:"opt.aliyun.id"}})],1),t("el-form-item",{attrs:{label:"AccessKey Secret"}},[t("el-input",{attrs:{placeholder:"登录阿里云工作台>点击主账号头像>AccessKey管理，创建生成。"},model:{value:e.opt.aliyun.key,callback:function(t){e.$set(e.opt.aliyun,"key",t)},expression:"opt.aliyun.key"}})],1),t("el-form-item",{attrs:{label:"BUCKET"}},[t("el-input",{attrs:{placeholder:"此处填入创建的Bucket名称。"},model:{value:e.opt.aliyun.bucket,callback:function(t){e.$set(e.opt.aliyun,"bucket",t)},expression:"opt.aliyun.bucket"}})],1),t("el-form-item",{attrs:{label:"ENDPOINT"}},[t("el-input",{attrs:{placeholder:"进入阿里云OSS的Bucket列表，找到对应的Bucket查看概述>访问端口>外网访问对应的Endpoint。"},model:{value:e.opt.aliyun.endpoint,callback:function(t){e.$set(e.opt.aliyun,"endpoint",t)},expression:"opt.aliyun.endpoint"}})],1),t("el-form-item",{attrs:{label:"访问域名"}},[t("el-input",{attrs:{placeholder:"进入阿里云OSS的Bucket列表，点击对应的Bucket>Bucket配置>域名管理>绑定域名。"},model:{value:e.opt.aliyun.domain,callback:function(t){e.$set(e.opt.aliyun,"domain",t)},expression:"opt.aliyun.domain"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("save",e.opt)}}},[e._v("保存")]),t("el-button",{on:{click:function(t){return e.$emit("cancel")}}},[e._v("取消")])],1)],1)],1),t("el-tab-pane",{attrs:{label:"腾讯云",name:"tencent"}},[t("el-form",{ref:"form1",attrs:{size:"small",model:e.opt,"label-width":"10em"}},[t("el-form-item",{attrs:{label:"SecretId"}},[t("el-input",{attrs:{placeholder:"登录腾讯云控制台>点击主账号头像>访问管理>访问密钥>API密钥管理，创建生成。"},model:{value:e.opt.tencent.id,callback:function(t){e.$set(e.opt.tencent,"id",t)},expression:"opt.tencent.id"}})],1),t("el-form-item",{attrs:{label:"SecretKey"}},[t("el-input",{attrs:{placeholder:"登录腾讯云控制台>点击主账号头像>访问管理>访问密钥>API密钥管理，创建生成。"},model:{value:e.opt.tencent.key,callback:function(t){e.$set(e.opt.tencent,"key",t)},expression:"opt.tencent.key"}})],1),t("el-form-item",{attrs:{label:"存储桶名称"}},[t("el-input",{attrs:{placeholder:"此处填入创建的存储桶名称。"},model:{value:e.opt.tencent.bucket,callback:function(t){e.$set(e.opt.tencent,"bucket",t)},expression:"opt.tencent.bucket"}})],1),t("el-form-item",{attrs:{label:"所属地域"}},[t("el-input",{attrs:{placeholder:"进入腾讯云COS存储桶列表，找到对应的存储桶>所属地域对应的英文部分。"},model:{value:e.opt.tencent.endpoint,callback:function(t){e.$set(e.opt.tencent,"endpoint",t)},expression:"opt.tencent.endpoint"}})],1),t("el-form-item",{attrs:{label:"访问域名"}},[t("el-input",{attrs:{placeholder:"进入腾讯云COS的桶列表，点击对应的存储桶>域名与传输管理>自定义CDN加速域名或者源站域名。"},model:{value:e.opt.tencent.domain,callback:function(t){e.$set(e.opt.tencent,"domain",t)},expression:"opt.tencent.domain"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("save",e.opt)}}},[e._v("保存")]),t("el-button",{on:{click:function(t){return e.$emit("cancel")}}},[e._v("取消")])],1)],1)],1),t("el-tab-pane",{attrs:{label:"华为云",name:"huawei"}},[t("el-form",{ref:"form2",attrs:{size:"small",model:e.opt,"label-width":"10em"}},[t("el-form-item",{attrs:{label:"Access Key Id"}},[t("el-input",{attrs:{placeholder:"登录华为云控制台>点击主账号名称>访问管理>我的凭证>访问密钥，创建生成。"},model:{value:e.opt.huawei.id,callback:function(t){e.$set(e.opt.huawei,"id",t)},expression:"opt.huawei.id"}})],1),t("el-form-item",{attrs:{label:"Secret Access Key"}},[t("el-input",{attrs:{placeholder:"登录华为云控制台>点击主账号名称>访问管理>我的凭证>访问密钥，创建生成。"},model:{value:e.opt.huawei.key,callback:function(t){e.$set(e.opt.huawei,"key",t)},expression:"opt.huawei.key"}})],1),t("el-form-item",{attrs:{label:"桶名称"}},[t("el-input",{attrs:{placeholder:"此处填入创建的存储桶名称。"},model:{value:e.opt.huawei.bucket,callback:function(t){e.$set(e.opt.huawei,"bucket",t)},expression:"opt.huawei.bucket"}})],1),t("el-form-item",{attrs:{label:"Endpoint"}},[t("el-input",{attrs:{placeholder:"进入华为云OBS桶列表，找到对应的桶查看概览>基本信息>Endpoint。"},model:{value:e.opt.huawei.endpoint,callback:function(t){e.$set(e.opt.huawei,"endpoint",t)},expression:"opt.huawei.endpoint"}})],1),t("el-form-item",{attrs:{label:"访问域名"}},[t("el-input",{attrs:{placeholder:"进入华为云OBS的桶列表，点击对应的存储桶>域名管理>配置加速域名。"},model:{value:e.opt.huawei.domain,callback:function(t){e.$set(e.opt.huawei,"domain",t)},expression:"opt.huawei.domain"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("save",e.opt)}}},[e._v("保存")]),t("el-button",{on:{click:function(t){return e.$emit("cancel")}}},[e._v("取消")])],1)],1)],1),t("el-tab-pane",{attrs:{label:"百度云",name:"baidu"}},[t("el-form",{ref:"form3",attrs:{size:"small",model:e.opt,"label-width":"10em"}},[t("el-form-item",{attrs:{label:"Access Key"}},[t("el-input",{attrs:{placeholder:"登录百度云控制台>点击主账号头像>安全认证>创建Access Key，创建生成。"},model:{value:e.opt.baidu.id,callback:function(t){e.$set(e.opt.baidu,"id",t)},expression:"opt.baidu.id"}})],1),t("el-form-item",{attrs:{label:"Secret Key\t"}},[t("el-input",{attrs:{placeholder:"登录百度云控制台>点击主账号头像>安全认证>创建Access Key，创建生成。"},model:{value:e.opt.baidu.key,callback:function(t){e.$set(e.opt.baidu,"key",t)},expression:"opt.baidu.key"}})],1),t("el-form-item",{attrs:{label:"BUCKET"}},[t("el-input",{attrs:{placeholder:"此处填入创建的BUCKET名称。"},model:{value:e.opt.baidu.bucket,callback:function(t){e.$set(e.opt.baidu,"bucket",t)},expression:"opt.baidu.bucket"}})],1),t("el-form-item",{attrs:{label:"官方域名"}},[t("el-input",{attrs:{placeholder:"进入百度云BOS对象存储Bucket列表，找到对应的Bucket查看概览>域名发布信息>官方域名。"},model:{value:e.opt.baidu.endpoint,callback:function(t){e.$set(e.opt.baidu,"endpoint",t)},expression:"opt.baidu.endpoint"}})],1),t("el-form-item",{attrs:{label:"访问域名"}},[t("el-input",{attrs:{placeholder:"进入百度云BOS对象存储Bucket列表，点击对应的Bucket>发布管理>官方域名或者自定义域名。"},model:{value:e.opt.baidu.domain,callback:function(t){e.$set(e.opt.baidu,"domain",t)},expression:"opt.baidu.domain"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$emit("save",e.opt)}}},[e._v("保存")]),t("el-button",{on:{click:function(t){return e.$emit("cancel")}}},[e._v("取消")])],1)],1)],1)],1),t("wb-key-point",{staticClass:"mt"},[t("dl",[t("dt",[e._v("温馨提示")]),t("dd",[e._v("目前仅支持阿里云、腾讯云、华为云和百度云对象存储服务商，如有其他对象存储添加需求，可以通过闪电博工单提交建议。")]),t("dd",[e._v("各家对象存储服务器商的配置大同小异，查看"),t("a",{attrs:{href:"https://www.wbolt.com/aliyun-oss.html?utm_source=wpturbo",target:"_blank"}},[e._v("详细配置教程")]),e._v("。")]),t("dd",[e._v("如对象存储对接WordPress站点资源属于对外开放访问资源，务必选择公共读策略。")]),t("dd",[e._v("访问域名尽可能选择自定义域名，而且最好使用CDN域名，这样可以实现CDN+对象存储的方式对网站静态资源进行加速。")])])])],1)},m=[function(){var e=this,t=e._self._c;return t("h3",{staticClass:"sc-header"},[t("strong",[e._v("对象存储服务商配置")])])}],b={name:"FormVendorApi",props:["opt"],provide(){return{needPro:!0}},data(){return{activeName:"aliyun"}},mounted(){window.scrollTo(0,0)}},f=b,v=Object(c["a"])(f,d,m,!1,null,null,null),_=v.exports,h={name:"WPTurboStorage",components:{FormVendorApi:_,FormServerOptions:u},provide(){return{needPro:!0}},inject:["getPro"],data(){const e=this;return{editing:"base",wb_cnf:e.$cnf,formChanged:0,isLoaded:0,loading:0,media_num:0,is_pro:e.$cnf.is_pro,oss_mode:"back",in_sync:!1,opt:{aliyun:{},tencent:{}}}},created(){const e=this;e.loadData(),e.$verify((t,o)=>{e.$cnf.is_pro=t})},methods:{loadData(){const e=this;e.loading=e.$wbui.loading(),e.$api.getData({_ajax_nonce:_wb_wpturbo_ajax_nonce,action:e.$cnf.action.act,op:"storage_setting"}).then(t=>{e.$wbui.close(e.loading),e.opt=t["opt"],e.oss_mode=e.opt.oss_mode,"server_adv"===e.opt.oss_mode&&(e.oss_mode="server"),e.media_num=t["media_num"],e.isLoaded=1})},updateData(e){const t=this,o={_ajax_nonce:_wb_wpturbo_ajax_nonce,action:t.$cnf.action.act,op:"storage_update",opt:t.opt};t.$api.saveData(o).then(o=>{t.$wbui.toast("设置保存成功"),t.formChanged=1,e&&e()})},changeServer(e){const t=this;t.opt=e,t.oss_mode=t.opt.oss_mode,"server_adv"===t.opt.oss_mode&&(t.oss_mode="server")},syncData(){const e=this;e.in_sync?e.$wbui.toast("资源正在同步中。如长时间无响应，请刷新重试。"):(e.in_sync=!0,e.$wbui.confirm("确认迁移媒体库资源到OSS？",(function(){e.runOssUpload()})))},runOssUpload(){const e=this,t={_ajax_nonce:_wb_wpturbo_ajax_nonce,action:e.$cnf.action.act,op:"storage_upload_media_to_oss",total:e.media_num};e.$api.saveData(t).then(t=>{if(t["code"])return e.$wbui.toast("同步数据异常，请刷新重试。"),void(e.in_sync=!1);e.media_num=t["data"],e.media_num&&e.media_num>0?setTimeout(()=>{e.runOssUpload()},200):e.in_sync=!1})}},watch:{opt:{handler(){this.formChanged++},deep:!0}},beforeRouteLeave(e,t,o){const a=this;a.formChanged>1?a.$wbui.open({content:"您修改的设置尚未保存，确定离开此页面吗？",btn:["保存并离开","放弃修改"],yes(){return o(!1),a.updateData((function(){o()})),!1},no(){return o(),!1}}):o()}},k=h,w=Object(c["a"])(k,a,n,!1,null,null,null);t["default"]=w.exports}}]);